import { createAsyncThunk, createSlice } from '@reduxjs/toolkit';

import {
    generateMines,
    generateOperations,
    generateMarketPrices,
    generateResourceManagement,
    generateEnvironmentalImpact,
    generateSafetyRecords,
    generateProductionPlanning,
    generateWeatherData
  } from './../../utils/dataGenerator';

const initialState = {
  data: null,
  status:'idle',
};


export const initData = createAsyncThunk(
  'data/initData',
  async () => {
    
    await new Promise(resolve => setTimeout(resolve, 2 * 1000))

    const numRecords = 10;
    const data = {}
    data.mines = generateMines(numRecords);
    data.operations = generateOperations(numRecords * 5, data.mines);
    data.marketPrices = generateMarketPrices(numRecords * 2);
    data.resourceManagement = generateResourceManagement(numRecords * 5, data.mines);
    data.environmentalImpact = generateEnvironmentalImpact(numRecords * 5, data.mines);
    data.safetyRecords = generateSafetyRecords(numRecords * 5, data.mines);
    data.productionPlanning = generateProductionPlanning(numRecords * 5, data.mines);
    data.weatherData = generateWeatherData(numRecords * 5, data.mines);

    return data;

  }
);

export const dataSlice = createSlice({
  name: 'data',
  initialState,
  // The `reducers` field lets us define reducers and generate associated actions
  reducers: {},
  // The `extraReducers` field lets the slice handle actions defined elsewhere,
  // including actions generated by createAsyncThunk or in other slices.
  extraReducers: (builder) => {
    builder
      .addCase(initData.pending, (state) => {
        state.status = 'loading';
      })
      .addCase(initData.fulfilled, (state, action) => {
        state.status = 'idle';
        state.data = action.payload;
      });
  },
});


// The function below is called a selector and allows us to select a value from
// the state. Selectors can also be defined inline where they're used instead of
// in the slice file. For example: `useSelector((state: RootState) => state.counter.value)`
export const selectData = (state) => state.data.data;
export const selectStatus = (state) => state.data.status;

export default dataSlice.reducer;
